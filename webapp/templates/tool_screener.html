{% extends "base.html" %}
{% block title %}Screener - Trade Auditor{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 py-8" x-data="{ screenerType: 'market' }">

    <!-- Header Content -->
    <div class="text-center mb-10 fade-in">
        <h1 class="text-4xl font-extrabold text-gray-900 dark:text-white mb-2">Locate Your Edge</h1>
        <p class="text-xl text-primary-600 dark:text-primary-400 font-medium">Stop guessing. Start scanning.</p>

        <div class="mt-6 text-left max-w-2xl mx-auto bg-gray-50 dark:bg-gray-800 rounded-xl p-6 border border-gray-200 dark:border-gray-700">
            <h3 class="font-bold text-gray-900 dark:text-white mb-3">Key Features:</h3>
            <ul class="space-y-2 text-sm text-gray-600 dark:text-gray-300">
                <li class="flex items-start">
                    <i class="bi bi-check-circle-fill text-green-500 mt-0.5 mr-2"></i>
                    <span><strong>Market Scan:</strong> Filter tickers by IV Rank and RSI thresholds to find premium-selling or mean-reversion opportunities.</span>
                </li>
                <li class="flex items-start">
                    <i class="bi bi-check-circle-fill text-green-500 mt-0.5 mr-2"></i>
                    <span><strong>Technical Setups:</strong> Auto-detect "Turtle" trends and 5/13 EMA crossovers.</span>
                </li>
                <li class="flex items-start">
                    <i class="bi bi-check-circle-fill text-green-500 mt-0.5 mr-2"></i>
                    <span><strong>Global Reach:</strong> Support for US, UK/Euro, and Indian markets.</span>
                </li>
            </ul>
        </div>
    </div>

    <!-- Screener Interface -->
    <div class="bg-white dark:bg-gray-900 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-800 p-6 md:p-8 fade-in" style="animation-delay: 0.2s;">

        <!-- Strategy Selector -->
        <div class="mb-8">
            <label for="screener_type" class="block mb-2 text-sm font-bold text-gray-900 dark:text-white uppercase tracking-wider">Select Screener Strategy</label>
            <div class="relative">
                <select id="screener_type" x-model="screenerType" class="block w-full p-4 pl-4 text-sm text-gray-900 border border-gray-300 rounded-xl bg-gray-50 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500 appearance-none shadow-sm">
                    <option value="market">Market Screener (RSI/IV)</option>
                    <option value="turtle">Turtle Trading (US)</option>
                    <option value="turtle_uk">Turtle Trading (UK/Euro)</option>
                    <option value="turtle_india">Turtle Trading (India)</option>
                    <option value="ema">5/13 & 5/21 EMA (US)</option>
                    <option value="ema_uk">5/13 & 5/21 EMA (UK/Euro)</option>
                    <option value="ema_india">5/13 & 5/21 EMA (India)</option>
                </select>
                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-gray-500">
                    <i class="bi bi-chevron-down"></i>
                </div>
            </div>
        </div>

        <!-- Market Screener Form -->
        <form action="/screen" method="post" class="space-y-6" x-show="screenerType === 'market'">
             <div class="p-4 text-sm text-primary-800 rounded-lg bg-primary-50 dark:bg-gray-800 dark:text-primary-400 border border-primary-100 dark:border-primary-900 flex items-start" role="alert">
                <i class="bi bi-info-circle-fill mr-2 text-lg"></i>
                <span class="font-medium mt-0.5">Scanner Active: Finding liquid stocks with RSI < 50 in an uptrend.</span>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="relative group">
                    <input type="number" name="iv_rank" id="iv_rank" value="30" step="0.1" class="block px-2.5 pb-2.5 pt-4 w-full text-sm text-gray-900 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-300 appearance-none dark:text-white dark:border-gray-600 focus:outline-none focus:ring-0 focus:border-primary-600 peer" placeholder=" " />
                    <label for="iv_rank" class="absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white dark:bg-gray-900 px-2 peer-focus:px-2 peer-focus:text-primary-600 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 start-1">IV Rank (Min)</label>
                    <p class="mt-1 text-xs text-gray-400">Filter candidates (Note: IV Rank requires manual check).</p>
                </div>

                <div class="relative group">
                    <input type="number" name="rsi" id="rsi" value="50" step="1" class="block px-2.5 pb-2.5 pt-4 w-full text-sm text-gray-900 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-300 appearance-none dark:text-white dark:border-gray-600 focus:outline-none focus:ring-0 focus:border-primary-600 peer" placeholder=" " />
                    <label for="rsi" class="absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white dark:bg-gray-900 px-2 peer-focus:px-2 peer-focus:text-primary-600 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 start-1">RSI Less Than</label>
                    <p class="mt-1 text-xs text-gray-400">Target oversold conditions (RSI < X) in an uptrend.</p>
                </div>
            </div>

            <div class="relative">
                <select name="time_frame" id="time_frame" class="block px-2.5 pb-2.5 pt-4 w-full text-sm text-gray-900 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-primary-500 focus:outline-none focus:ring-0 focus:border-primary-600 peer">
                    <option value="49m">49m (Intraday)</option>
                    <option value="98m">98m (Intraday)</option>
                    <option value="196m">196m (Intraday)</option>
                    <option value="1d" selected>1 Day</option>
                    <option value="1wk">1 Week</option>
                    <option value="1mo">1 Month</option>
                </select>
                <label for="time_frame" class="absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white dark:bg-gray-900 px-2 peer-focus:px-2 peer-focus:text-primary-600 peer-focus:dark:text-primary-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 rtl:peer-focus:translate-x-1/4 rtl:peer-focus:left-auto start-1">Time Frame</label>
            </div>

            <button type="button" onclick="this.form.submit()" class="w-full text-white bg-indigo-600 hover:bg-indigo-700 font-bold rounded-xl text-lg px-5 py-4 shadow-lg transition-all hover:scale-[1.02]">
                <i class="bi bi-search mr-2"></i> Screen Market
            </button>
        </form>

        <!-- Turtle Screener Form (US) -->
        <div x-show="screenerType === 'turtle'" class="space-y-6">
            <div class="p-4 text-sm text-green-800 rounded-lg bg-green-50 dark:bg-gray-800 dark:text-green-400 border border-green-100 dark:border-green-900" role="alert">
                <span class="font-bold block mb-1">Turtle Strategy (US)</span>
                Scans for 20-Day Breakouts (Donchian Channels).
            </div>
            <p class="text-sm text-gray-500 dark:text-gray-400 pl-1">
                This screen checks a basket of liquid ETFs and Blue Chip stocks for trend following setups.
                <br>
                <strong>Buy Signal:</strong> Price > 20-Day High.
                <br>
                <strong>Stop Loss:</strong> 2x ATR.
            </p>

            <form action="/screen/turtle" method="get">
                <div class="relative mb-6">
                    <select name="time_frame" class="block px-2.5 pb-2.5 pt-4 w-full text-sm text-gray-900 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-green-500 focus:outline-none focus:ring-0 focus:border-green-600 peer">
                        <option value="49m">49m (Intraday)</option>
                        <option value="98m">98m (Intraday)</option>
                        <option value="196m">196m (Intraday)</option>
                        <option value="1d" selected>1 Day</option>
                        <option value="1wk">1 Week</option>
                        <option value="1mo">1 Month</option>
                    </select>
                    <label class="absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white dark:bg-gray-900 px-2 peer-focus:px-2 peer-focus:text-green-600 peer-focus:dark:text-green-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 rtl:peer-focus:translate-x-1/4 rtl:peer-focus:left-auto start-1">Time Frame</label>
                </div>
                <button type="submit" class="w-full text-white bg-green-600 hover:bg-green-700 font-bold rounded-xl text-lg px-5 py-4 text-center shadow-lg transition-all hover:scale-[1.02]">
                    Run Turtle Screen
                </button>
            </form>
        </div>

        <!-- Turtle Screener Form (India) -->
        <div x-show="screenerType === 'turtle_india'" class="space-y-6">
            <div class="p-4 text-sm text-green-800 rounded-lg bg-green-50 dark:bg-gray-800 dark:text-green-400 border border-green-100 dark:border-green-900" role="alert">
                <span class="font-bold block mb-1">Turtle Strategy (India)</span>
                Scans for 20-Day Breakouts on Nifty 50 & Next 50.
            </div>

            <form action="/screen/turtle" method="get">
                <input type="hidden" name="region" value="india">
                <div class="relative mb-6">
                    <select name="time_frame" class="block px-2.5 pb-2.5 pt-4 w-full text-sm text-gray-900 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-green-500 focus:outline-none focus:ring-0 focus:border-green-600 peer">
                        <option value="49m">49m (Intraday)</option>
                        <option value="98m">98m (Intraday)</option>
                        <option value="196m">196m (Intraday)</option>
                        <option value="1d" selected>1 Day</option>
                        <option value="1wk">1 Week</option>
                        <option value="1mo">1 Month</option>
                    </select>
                    <label class="absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white dark:bg-gray-900 px-2 peer-focus:px-2 peer-focus:text-green-600 peer-focus:dark:text-green-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 rtl:peer-focus:translate-x-1/4 rtl:peer-focus:left-auto start-1">Time Frame</label>
                </div>
                <button type="submit" class="w-full text-white bg-green-600 hover:bg-green-700 font-bold rounded-xl text-lg px-5 py-4 text-center shadow-lg transition-all hover:scale-[1.02]">
                    Run Turtle Screen (India)
                </button>
            </form>
        </div>

        <!-- Turtle Screener Form (UK/Euro) -->
        <div x-show="screenerType === 'turtle_uk'" class="space-y-6">
            <div class="p-4 text-sm text-green-800 rounded-lg bg-green-50 dark:bg-gray-800 dark:text-green-400 border border-green-100 dark:border-green-900" role="alert">
                <span class="font-bold block mb-1">Turtle Strategy (UK/Euro)</span>
                Scans for 20-Day Breakouts on FTSE/Euro Stocks.
            </div>

            <form action="/screen/turtle" method="get">
                <input type="hidden" name="region" value="uk_euro">
                <div class="relative mb-6">
                    <select name="time_frame" class="block px-2.5 pb-2.5 pt-4 w-full text-sm text-gray-900 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-green-500 focus:outline-none focus:ring-0 focus:border-green-600 peer">
                        <option value="49m">49m (Intraday)</option>
                        <option value="98m">98m (Intraday)</option>
                        <option value="196m">196m (Intraday)</option>
                        <option value="1d" selected>1 Day</option>
                        <option value="1wk">1 Week</option>
                        <option value="1mo">1 Month</option>
                    </select>
                    <label class="absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white dark:bg-gray-900 px-2 peer-focus:px-2 peer-focus:text-green-600 peer-focus:dark:text-green-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 rtl:peer-focus:translate-x-1/4 rtl:peer-focus:left-auto start-1">Time Frame</label>
                </div>
                <button type="submit" class="w-full text-white bg-green-600 hover:bg-green-700 font-bold rounded-xl text-lg px-5 py-4 text-center shadow-lg transition-all hover:scale-[1.02]">
                    Run Turtle Screen (UK/Euro)
                </button>
            </form>
        </div>

        <!-- 5/13 EMA Screener Form (India) -->
        <div x-show="screenerType === 'ema_india'" class="space-y-6">
            <div class="p-4 text-sm text-indigo-800 rounded-lg bg-indigo-50 dark:bg-gray-800 dark:text-indigo-400 border border-indigo-100 dark:border-indigo-900" role="alert">
                <span class="font-bold block mb-1">5/13 & 5/21 EMA (India)</span>
                Momentum Breakouts on Nifty 50 & Next 50.
            </div>

            <form action="/screen/ema" method="get">
                <input type="hidden" name="region" value="india">
                <div class="relative mb-6">
                    <select name="time_frame" class="block px-2.5 pb-2.5 pt-4 w-full text-sm text-gray-900 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-indigo-500 focus:outline-none focus:ring-0 focus:border-indigo-600 peer">
                        <option value="49m">49m (Intraday)</option>
                        <option value="98m">98m (Intraday)</option>
                        <option value="196m">196m (Intraday)</option>
                        <option value="1d" selected>1 Day</option>
                        <option value="1wk">1 Week</option>
                        <option value="1mo">1 Month</option>
                    </select>
                    <label class="absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white dark:bg-gray-900 px-2 peer-focus:px-2 peer-focus:text-indigo-600 peer-focus:dark:text-indigo-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 rtl:peer-focus:translate-x-1/4 rtl:peer-focus:left-auto start-1">Time Frame</label>
                </div>
                <button type="submit" class="w-full text-white bg-indigo-600 hover:bg-indigo-700 font-bold rounded-xl text-lg px-5 py-4 text-center shadow-lg transition-all hover:scale-[1.02]">
                    Run EMA Screen (India)
                </button>
            </form>
        </div>

        <!-- 5/13 EMA Screener Form (US) -->
        <div x-show="screenerType === 'ema'" class="space-y-6">
             <div class="p-4 text-sm text-indigo-800 rounded-lg bg-indigo-50 dark:bg-gray-800 dark:text-indigo-400 border border-indigo-100 dark:border-indigo-900" role="alert">
                <span class="font-bold block mb-1">5/13 & 5/21 EMA (US)</span>
                Momentum Breakouts & Trends.
            </div>
            <p class="text-sm text-gray-500 dark:text-gray-400 pl-1">
                Detects fast momentum shifts using Exponential Moving Averages.
                <br>
                <strong>Buy Signal:</strong> 5 EMA crosses ABOVE 13 or 21 EMA.
                <br>
                <strong>Stop Loss:</strong> Close below the slow EMA (13 or 21).
            </p>

            <form action="/screen/ema" method="get">
                <div class="relative mb-6">
                    <select name="time_frame" class="block px-2.5 pb-2.5 pt-4 w-full text-sm text-gray-900 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-indigo-500 focus:outline-none focus:ring-0 focus:border-indigo-600 peer">
                        <option value="49m">49m (Intraday)</option>
                        <option value="98m">98m (Intraday)</option>
                        <option value="196m">196m (Intraday)</option>
                        <option value="1d" selected>1 Day</option>
                        <option value="1wk">1 Week</option>
                        <option value="1mo">1 Month</option>
                    </select>
                    <label class="absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white dark:bg-gray-900 px-2 peer-focus:px-2 peer-focus:text-indigo-600 peer-focus:dark:text-indigo-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 rtl:peer-focus:translate-x-1/4 rtl:peer-focus:left-auto start-1">Time Frame</label>
                </div>
                <button type="submit" class="w-full text-white bg-indigo-600 hover:bg-indigo-700 font-bold rounded-xl text-lg px-5 py-4 text-center shadow-lg transition-all hover:scale-[1.02]">
                    Run EMA Screen
                </button>
            </form>
        </div>

        <!-- 5/13 EMA Screener Form (UK/Euro) -->
        <div x-show="screenerType === 'ema_uk'" class="space-y-6">
            <div class="p-4 text-sm text-indigo-800 rounded-lg bg-indigo-50 dark:bg-gray-800 dark:text-indigo-400 border border-indigo-100 dark:border-indigo-900" role="alert">
                <span class="font-bold block mb-1">5/13 & 5/21 EMA (UK/Euro)</span>
                Momentum Breakouts on FTSE/Euro Stocks.
            </div>

            <form action="/screen/ema" method="get">
                <input type="hidden" name="region" value="uk_euro">
                <div class="relative mb-6">
                    <select name="time_frame" class="block px-2.5 pb-2.5 pt-4 w-full text-sm text-gray-900 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-indigo-500 focus:outline-none focus:ring-0 focus:border-indigo-600 peer">
                        <option value="49m">49m (Intraday)</option>
                        <option value="98m">98m (Intraday)</option>
                        <option value="196m">196m (Intraday)</option>
                        <option value="1d" selected>1 Day</option>
                        <option value="1wk">1 Week</option>
                        <option value="1mo">1 Month</option>
                    </select>
                    <label class="absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white dark:bg-gray-900 px-2 peer-focus:px-2 peer-focus:text-indigo-600 peer-focus:dark:text-indigo-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 rtl:peer-focus:translate-x-1/4 rtl:peer-focus:left-auto start-1">Time Frame</label>
                </div>
                <button type="submit" class="w-full text-white bg-indigo-600 hover:bg-indigo-700 font-bold rounded-xl text-lg px-5 py-4 text-center shadow-lg transition-all hover:scale-[1.02]">
                    Run EMA Screen (UK/Euro)
                </button>
            </form>
        </div>
    </div>
</div>
{% endblock %}
