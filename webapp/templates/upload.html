{% extends "base.html" %}

{% block content %}
<article>
  <header>
    <h2 class="text-2xl font-semibold text-center">Upload Your Trades CSV</h2>
  </header>
  
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert" role="alert">
          {{ message }}
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <form hx-post="/analyze" hx-target="#results-container" hx-swap="innerHTML" hx-encoding="multipart/form-data" hx-indicator="#loading-spinner">
    
    <label for="csv">CSV File
      <input type="file" name="csv" id="csv" required>
    </label>

    <div class="grid">
        <label for="broker">Broker
          <select name="broker" id="broker">
            <option value="auto">Auto-detect</option>
            <option value="tasty">Tastytrade</option>
            <option value="ibkr">Interactive Brokers</option>
          </select>
        </label>
        <label for="date_mode">Date Range
          <select name="date_mode" id="date_mode">
            <option value="all">All Data</option>
            <option value="ytd">Year to Date</option>
            <option value="1y">Last 1 Year</option>
            <option value="6m">Last 6 Months</option>
            <option value="1m">Last 1 Month</option>
            <option value="14d">Last 14 Days</option>
            <option value="7d">Last 7 Days</option>
            <option value="range">Custom Range</option>
          </select>
        </label>
    </div>

    <div id="custom-range-fields" class="grid" style="display: none;">
      <label for="start_date">Start Date
        <input type="date" name="start_date" id="start_date">
      </label>
      <label for="end_date">End Date
        <input type="date" name="end_date" id="end_date">
      </label>
    </div>
    
    <details>
      <summary>Optional: Account Metrics</summary>
      <div class="grid">
        <label for="account_size_start">Account Size (Start)
          <input type="number" name="account_size_start" id="account_size_start" placeholder="e.g., 25000">
        </label>
        <label for="net_liquidity_now">Net Liquidity (Now)
          <input type="number" name="net_liquidity_now" id="net_liquidity_now" placeholder="e.g., 26500">
        </label>
        <label for="buying_power_available_now">Buying Power Available (Now)
          <input type="number" name="buying_power_available_now" id="buying_power_available_now" placeholder="e.g., 22000">
        </label>
      </div>
    </details>

    <button type="submit" id="loading-spinner">Analyze Trades</button>
  </form>
</article>

<div id="results-container" class="fade-in">
  <!-- Results will be loaded here -->
</div>

<script>
  document.getElementById('date_mode').addEventListener('change', function() {
    document.getElementById('custom-range-fields').style.display = this.value === 'range' ? 'grid' : 'none';
  });
</script>
{% endblock %}